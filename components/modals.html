<!-- Character Preset Modal -->
<div id="preset-modal" class="absolute inset-0 bg-black/40 z-[80] hidden flex items-center justify-center backdrop-blur-sm">
    <div class="bg-white w-[90%] max-w-[340px] rounded-2xl shadow-2xl max-h-[80%] flex flex-col">
        <div class="p-4 border-b border-gray-200 flex justify-between items-center shrink-0">
            <h3 class="font-bold text-lg">人设预设</h3>
            <button onclick="ProfileManager.closePresetModal()" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark text-xl"></i></button>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4">
            <div id="preset-list" class="space-y-2">
                <!-- Presets will be injected here -->
            </div>
        </div>

        <div class="p-4 border-t border-gray-200 shrink-0">
            <button onclick="ProfileManager.createNewPreset()" class="w-full bg-blue-500 text-white font-bold py-3 rounded-xl active:scale-95 transition">
                <i class="fa-solid fa-plus mr-2"></i>新建预设
            </button>
        </div>
    </div>
</div>

<!-- User Persona Modal -->
<div id="user-persona-modal" class="absolute inset-0 bg-black/40 z-[80] hidden flex items-center justify-center backdrop-blur-sm">
    <div class="bg-white w-[90%] max-w-[340px] rounded-2xl shadow-2xl max-h-[80%] flex flex-col">
        <div class="p-4 border-b border-gray-200 flex justify-between items-center shrink-0">
            <h3 class="font-bold text-lg">用户面具预设</h3>
            <button onclick="PersonaManager.closeModal()" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark text-xl"></i></button>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4">
            <div id="user-persona-list" class="space-y-2">
                <!-- Presets will be injected here -->
            </div>
        </div>

        <div class="p-4 border-t border-gray-200 shrink-0">
            <button onclick="PersonaManager.create()" class="w-full bg-indigo-500 text-white font-bold py-3 rounded-xl active:scale-95 transition">
                <i class="fa-solid fa-plus mr-2"></i>新建面具
            </button>
        </div>
    </div>
</div>

<!-- User Persona Edit Modal -->
<div id="user-persona-edit-modal" class="absolute inset-0 bg-black/40 z-[90] hidden flex items-center justify-center backdrop-blur-sm">
    <div class="bg-white w-[90%] max-w-[340px] rounded-2xl shadow-2xl max-h-[85%] flex flex-col">
        <div class="p-4 border-b border-gray-200 flex justify-between items-center shrink-0">
            <button onclick="PersonaManager.closeEditModal()" class="text-gray-500">取消</button>
            <h3 class="font-bold text-lg">编辑面具</h3>
            <button onclick="PersonaManager.save()" class="text-indigo-600 font-bold">保存</button>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4 space-y-4">
            <input type="hidden" id="edit-persona-index">
            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">面具名称</label>
                <input type="text" id="edit-persona-name" class="w-full bg-gray-100 rounded-lg p-3 font-bold text-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            </div>
            <div class="flex-1">
                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">面具内容 (用户人设)</label>
                <textarea id="edit-persona-content" rows="12" class="w-full bg-gray-100 rounded-lg p-3 text-sm text-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 leading-relaxed resize-none" placeholder="输入用户人设..."></textarea>
            </div>
        </div>
    </div>
</div>

<!-- ==================== EMOJI MANAGER APP ==================== -->
<div id="emoji-manager-modal" class="absolute inset-0 bg-black/40 z-[80] hidden flex items-center justify-center backdrop-blur-sm">
    <div class="bg-white w-[90%] max-w-[340px] rounded-2xl shadow-2xl max-h-[80%] flex flex-col">
        <div class="p-4 border-b border-gray-200 flex justify-between items-center shrink-0">
            <h3 class="font-bold text-lg">表情包管理</h3>
            <button onclick="EmojiManager.closeModal()" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark text-xl"></i></button>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4 space-y-4">
            <!-- Batch Import Section -->
            <div class="bg-gray-50 rounded-xl p-4 space-y-3">
                <label class="block text-xs font-bold text-gray-600 uppercase">批量导入表情包</label>
                <input type="text" id="emoji-group-name" class="w-full bg-white rounded-lg p-2 text-sm border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="分组名称 (必填)">
                <textarea id="emoji-batch-input" rows="6" class="w-full bg-white rounded-lg p-2 text-xs border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none font-mono" placeholder="格式：含义:URL 或 含义 URL&#10;每行一个，例如：&#10;开心:https://example.com/happy.gif&#10;难过 https://example.com/sad.gif"></textarea>
                <button onclick="EmojiManager.batchImport()" class="w-full bg-blue-500 text-white font-bold py-2 rounded-lg active:scale-95 transition">导入表情包</button>
            </div>

            <!-- Existing Groups -->
            <div>
                <label class="block text-xs font-bold text-gray-600 uppercase mb-2">已有分组</label>
                <div id="emoji-groups-list" class="space-y-2">
                    <!-- Groups will be injected here -->
                </div>
            </div>
        </div>
    </div>
</div>
